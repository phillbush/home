.Dd June 6, 2022
.Dt HOME 7
.Os
.Sh NAME
.Nm home
.Nd my system and how I interact with it
.Sh HARDWARE
I use a secondhand Lenovo Thinkpad T430 model 23501M2,
with an Intel(R) Core(TM) i5-3320M CPU @ 2.60GHz and 8GB of RAM.
.Pp
I applied the following modifications to the laptop:
.Bl -bullet -compact
.It
I replaced the DVD optical drive with a Serial Ultrabay Enhanced HDD Adapter.
The adapter contains a TOSHIBA MQ01ABD0 500GB HD.
.Lk https://thinkwiki.org/wiki/Ultrabay Ns .
.It
I replaced the T430 chiclet-style keyboard with the T420 classic keyboard,
using the method 2 (Sand down the nubs to fit in the T430 palmrest) on
.Lk https://thinkwiki.org/wiki/Upgrading_T430_Keyboard Ns .
I have not flashed the BIOS to make the keyboard work from boot yet;
but I use xkbcomp(1) to set the keymap on X11.
.It
I wrapped the T430 lid with a black faux leather vinyl adhesive.
.El
.Sh OPERATING SYSTEM
I use OpenBSD -current.
See
.Lk https://www.openbsd.org/faq
for more information on the operating system and how to install it.
.Pp
After installation, I run
.Xr userinfo 8
to make sure my user is in the wheel group and in the staff login class.
If it is not, I set it up with
.Xr usermod 8 .
.Pp
I create
.Pa /etc/doas.conf
to give administrator priviledges to the wheel group.
The example file at
.Pa /etc/examples/doas.conf
is reasonable,
but I also add
.Ic persist
to it so I'm not asked for password again for some time after successfully authenticating.
.Pp
The default system resources limits to the staff login class defined at
.Pa /etc/login.conf
are reasonable.
But the
.Ic datasize-cur
option can be increased a little bit, if necessary.
.Pp
I use the following programs available on the OpenBSD package repository.
.Bl -bullet -compact
.It
.Sy calc
.It
.Sy chibi-scheme
.It
.Sy colortree
.It
.Sy feh
.It
.Sy ffmpegthumbnailer Ns ,
.Sy ImageMagick Ns ,
.Sy poppler-utils Ns ,
.Sy mediainfo Ns ,
and
.Sy w3m Ns ,
to display thumbnails and file preview.
.It
.Sy firefox
(for js-intensive websites)
and
.Sy seamonkey
(for general web browsing).
.It
.Sy entr
.It
.Sy fzf
.It
.Sy git
.It
.Sy gnupg
.It
.Sy heirloom-doctools
.It
.Sy maim
.It
.Sy moreutils
.It
.Sy mpc Ns ,
.Sy mpd Ns ,
and
.Sy ncmpcpp Ns ,
to listen to music.
.It
.Sy mpv
.It
.Sy mutt Ns ,
.Sy isync Ns ,
and
.Sy msmtp Ns ,
for email.
.It
.Sy newsboat
.It
.Sy picom
.It
.Sy pstree
.It
.Sy rlwrap
.It
.Sy slop
.It
.Sy nsxiv
to open images
.It
.Sy unclutter
to remove the mouse cursor after some time when idle.
.It
.Sy unrar Ns ,
and
.Sy unzip
to zip/unzip.
.It
.Sy vim
is my default text editor
.It
.Sy wmapm Ns ,
.Sy wmclock Ns ,
.Sy WMmp
and
.Sy bubblemon-dockapp
for dockapps.
.It
.Sy wpa_supplicant
to connect to university's wireless network.
.It
.Sy wmctrl Ns ,
.Sy xdotool Ns ,
and
.Sy xsel Ns ,
to control X.
.It
.Sy zathura Ns ,
.Sy zathura-djvu Ns ,
.Sy zathura-pdf-poppler Ns ,
and
.Sy zathura-ps Ns .
.El
.Pp
I manually build and install the following programs:
.Bl -bullet -compact
.It
fmutils
.It
paginator
.It
pmenu
.It
shod
.It
xfiles
.It
xfilter
.It
xmenu
.It
xnotify
.El
.Pp
I run
.Xr fw_update 1
to install and update needed non-free firmware packages, and
.Xr syspatch 8
to update the base system.
.Pp
The following subsections describe the daemons I enable, and the configuration files I edit.
.Ss Power Management
I use
.Xr apmd 8
for power management.
I use the
.Fl L
flag instead of the
.Fl A
flag because it showed to heat less the computer.
I use the
.Fl z Cm 15
flag to suspend the system when the battery gets to 15% and no AC is connected.
I also use the
.Fl t Cm 60
flag for
.Xr apmd 8
to poll the power state once per minute and log it via
.Xr syslog 3 .
.Ss X11
If
.Xr xenodm 1
was not enabled during installation,
it can be done so later like any other system daemon.
I also edit xenodm's rc file to comment out the line calling
.Xr xconsole 1 ,
disabling the xconsole window on the login screen.
I also add the line `xset b off` to disable the system beep.
.Pp
To tidy my
.Pa $HOME/
directory,
I moved
.Pa ~/.xsession
to
.Pa ~/lib/xinitrc Ns .
For that to work, I need to edit
.Pa /etc/X11/xenodm/Xsession
and replace the value of the
.Sy startup
variable at the end of the script to 
.Sy $HOME/lib/xinitrc Ns .
.Pp
For the touchpad and the trackpoint of my laptop to work as expected,
I configure the
.Xr synaptics 4
X driver, by copying the file
.Pa /usr/X11R6/share/X11/xorg.conf.d/70-synaptics.conf
to
.Pa /etc/X11/xorg.conf.d/
(this directory should be created if non existant).
And then I uncomment the commented out
.Sy "Input Class"
session at the beginning of the file.
.Ss Web Server
I enable
.Xr httpd 8
on my laptop.
My laptop serves my webpage to the local network,
so I can test my webpage before deploying it to the remote server.
To do that, I first create the directory
.Pa /var/www/seninha.org/
and set my user ID and my group ID as its owner user and group.
Thus, when I run
.Ic make test
my webpage content is copied to that directory.
I configure
.Pa /etc/httpd.conf
as follows:
.Bd -literal -offset indent
# cat /etc/httpd.conf
server "seninha.org" {
	listen on * port 80
	root "/seninha.org"
}
.Ed
.Pp
Then, I just need to open the browser at
.Lk http://localhost
and check the changes to my webpage.
.Ss Network
I need
.Xr wpa_supplicant 8
to connect to university's wireless network.
After installing it with
.Xr pkg_add 1 ,
I enable it and edit its configuration file.
.Bd -literal -offset indent
# cat /etc/wpa_supplicant.conf
[...]
network={
        ssid="UNB Wireless"
        key_mgmt=WPA-EAP
        eap=TTLS PEAP
        identity="<MY_USER_ID>"
        password="<MY_PASSWORD>"
}
[...]
.Ed
.Pp
The file
.Pa /etc/hostname.iwn0
contains the wireless networks I use at home and at uni:
.Bd -literal -offset indent
# cat /etc/hostname.iwn0
join "<HOME_NETWORK>" wpakey "<NETWORK_PASSWORD>"
join "UNB Wireless" wpa wpaakms 802.1x
inet6 autoconf
dhcp
.Ed
.Ss Recording
.Pp
I did not use mic until covid happen.  Then I had to do audio calls
every week.  I rarelly use camera, however.  Mic and camera recording
can be enabled by writing to /etc/sysctl.conf.
.Bd -literal -offset indent
# cat /etc/sysctl.conf
kern.audio.record=1
kern.video.record=1
.Ed
.Sh SHELL SESSION
I use
.Xr ksh 1
with emacs-like keybindings, and brace expansion.
The interactive shell is initialized by the
.Pa ~/lib/kshrc
script.
At the beginning of this script, it sources the system-wide
.Pa /etc/ksh.kshrc
if this file exists.
History is saved on
.Pa ~/var/history/ksh_history .
.Pp
The function
.Ic cd
extends the homonym builtin command with a more powerful syntax.
For example,
.Ic cd ...
to go two directories up,
and
.Ic cd .../foo
to go to
.Pa ../../foo .
This function also implements features from
.Ic pushd
and
.Ic popd Ns .
.Pp
The function
.Ic dir
is a wrapper around
.Xr colortree 1 .
It can recursively list the entries of the current working directory,
or recursively search for a file given as argument.
It replaces
.Xr ls 1
and
.Xr find 1
for me.
.Pp
The function
.Ic fuck
runs previous non-doas command with
.Xr doas 1
or retry previos doas command.
.Pp
The function
.Ic hist
searches command history and rerun or edit a past command.
It replaces
.Sy Ctrl-R
and
.Ic fc
for me.
.Pp
I set some aliases:
.Bl -bullet -compact
.It
Muscle memory aliases, like
.Ic :q
and
.Ic :Q
to exit the shell.
.It
Interactive, recursive and verbose aliases for directory manipulation commands
(like
.Xr rm 1 ,
.Xr mv 1
etc)
.It
.Xr ls 1
alias for different options,
such as
.Ic ll
for
.Ic ls -l
and others.
.It
Human readable output for
.Xr df 1
and
.Xr du 1 .
.It
Lazy one-letter aliases for
.Xr less 1
(l),
.Xr vim 1
(v),
.Xr cd 1
(c),
.Xr readme 1
(r),
etc.
.It
Typos, like
.Ic makemake
and
.Ic mkae
for
.Xr make 1 .
.It
Aliases for
.Xr rlwrap
wrapped around interpreters and REPL.
.El
.Pp
I set completions for arguments of the following commands.
All completions are set once at the beginning of the shell session,
except for
.Xr make 1 ,
which is set whenever I run
.Ic cd
to the current change directory.
.Bl -bullet -compact
.It
.Xr skel 1 ,
completed with files from
.Pa ~/lib/skel/ .
.It
.Xr make 1 ,
completed with targets from the current Makefile.
.It
.Xr sysctl 1 ,
completed with kernel state variables.
.It
.Xr rcctl 1 ,
completed with sub-commands as first argument,
and with the names of servers and daemons as second argument.
.It
.Xr git 1 ,
completed with git sub-commands.
.It
.Xr mpc 1 ,
completed with mpc sub-commands as first argument
and with playlists as second argument.
.It
.Xr kill 1
and
.Xr pkill 1 ,
completed with commonly used signals.
.It
.Xr ssh 1 ,
completed with host aliases from my
.Pa ~/.ssh/config .
.It
.Xr ifconfig 1 ,
completed with the names of known interfaces.
.It
.Xr vmctl 1 ,
completed with vmctl sub-commands.
.El
.Pp
My
.Ev PS1
sets the window title and an upper prompt, a left prompt and a right prompt.
The window title is set to the name of the tty and the cwd
(for example,
.Em ttyp2: ~/tmp Ns ).
The upper prompt is a newline (for vertical spacement).
The left prompt is the hostname (if running on ssh) and a left arrow
(which gets red when logged as super user).
The right prompt is the cwd.
.Pp
I trap the ERR special signal to notify the exit status of the last command,
when it is nonzero.
.Sh X11 SESSION
I use
.Xr shod 1
as window manager.
Its main feature is the possibility to tile, and even tab, windows inside floating containers.
Shod also displays a dock where there are the following dockapps.
.Bl -tag -width Ds
.It Xr xmenu 1
A menu system.
It lists menu entries.
I can navigate through the menus and select an entry to be executed by the shell.
Each entry in the menu can be bound to a key press.
For example, I bind
.Sy Alt+T
to open a terminal.
Xmenu can also launch
.Xr xfilter 1 ,
which I use to search for entries and select an entry by typing its name.
.It Xr paginator 1
A desktop pager.
It display miniatures for the virtual desktops and for the windows on them.
.It Xr wmapm 1
An
.Xr apm 8
monitor for batery.
.It Xr WMmp 1
A mpd controller.
It shows the currently playing song
and has buttons to change it.
.It Xr bubblemon 1
A system load monitor in the form of a rubber duck.
.It Xr wmclock 1
A NeXTSTEP-like clock and calendar.
.El
.Pp
I use
.Xr xnotify 1
for displaying notifications on the screen.
Xnotify reads notification strings from the standard input,
and display each notification on a small window on the screen.
To be usable, it must read from a named pipe,
which other programs should write into.
I use
.Xr xnotify 1
in the managed mode, in which the window manager controll the notification windows.
The following programs write into the notification pipe:
.Bl -tag -width Ds
.It Ic notifycpu
This function in
.Pa ~/.xsession
reads the
.Pa /var/log/daemon
log file and checks for battery and CPU temperature,
notifying when the battery gets low and the CPU gets hot.
.It Ic notifymus
This function in
.Pa ~/.xsession
uses
.Xr mpc 1
to notify when the current song changes.
.El
.Pp
I use
.Xr picom 1
as my X11 compositor.
I invoke it with a set of command-line arguments that creates a "blue aura" around the active window.
.Sh ENVIRONMENT
The following environment variables are set by the
.It Pa ~/.profile
script.
.Bl -tag -width Ds
.It Ev CACHEDIR
Cache directory.
.It Ev DEBUG
Debug flags used by
.Xr make 1
to pass to
.Xr cc 1 .
.It Ev EDITOR
Default editor program.
.It Ev GOPATH
Directory where software managed by
.Xr go 1
should be installed.
.It Ev GNUPGHOME
Configuration directory for
.Xr gpg 1 .
.It Ev LANG
Fallback locale.
.It Ev MANPREFIX
Directory where manuals should be installed.
.It Ev MIMEFILE
File containing mimetype-application relationships.
.It Ev MUSICDIR
Music directory.
.It Ev OPENER
Default file opener program.
.It Ev PAGER
Default pager program.
.It Ev PREFIX
Directory where manually compiled software should be installed.
.It Ev PROJDIR
Directory where projects are maintained.
.It Ev RLWRAP_HOME
Shell history directory used by
.Xr rlwrap 1 .
.It Ev RULESDIR
Directory where configuration files are installed.
.It Ev SKEL
Directory containing template (skeleton) files.
.It Ev TERMCMD
Default terminal emulator program.
.It Ev THUMBNAILER
Default thumbnail generator program.
.It Ev TMACPREFIX
Directory where troff macros are installed.
.It Ev TRASH
Trash directory maintained by
.Xr trash 1 .
.It Ev TROFFMACS
Path to troff macros prefix.
.It Ev TZ
Timezone.
.It Ev VISUAL
Default editor program.
.It Ev XCOMPOSEFILE
File containing key symbol compositions.
.It Ev XDG_CACHE_HOME
xdg shit
.It Ev XDG_CONFIG_HOME
xdg shit
.It Ev XDG_DATA_HOME
xdg shit
.El
.Sh FILES
The contents of my
.Ev HOME
are listed below.
.Bl -tag -width Ds
.It Pa ~/doc/
Directory where I archive documents.
It contains mostly non-fiction books and videos of lectures.
But I also archive there RPG books and fiction (both in book and movie formats).
.It Pa ~/mem/
Meme directory.
.It Pa ~/mus/
Music directory.
(Since this directory is managed by
.Xr mpd 1
and related programs, shouldn't it be at
.Pa ~/var/ Ns ?)
.It Pa ~/prj/
Directory where I store whatever I am working on
(mostly college stuff, things I am learning and programs I maintain).
Each project has a subdirectory in it.
For example,
.Pa ~/prj/xmenu/
is for
.Xr xmenu 1 ;
.Pa ~/prj/c/
is for notes on the C Programming Language; etc.
.It Pa ~/lib/
Directory where I store configuration files (aka dotfiles).
For example,
.Pa ~/lib/vimrc
is the configuration file for
.Xr vim 1 .
.Pa ~/lib/
also contain some directories.
The directory
.Pa ~/lib/skel/
is where I store skeleton files
(that is, templates for different file formats).
For example,
.Pa ~/lib/skel/Makefile
is a template for a Makefile;
.Pa ~/lib/skel/man.1
is a template for a section 1 man page; etc.
.It Pa ~/tmp/
Directory where I dump stuff.
It contains mostly downloaded files.
I try to keep it clean, but most of the time it is a mess.
.It Pa ~/usr/
Directory for program files (binaries, sources, manuals, etc).
Each subdirectory contain files installed from a given source or using a
given method.
For example,
.Pa ~/usr/local/
contains data of programs I install manually;
.Pa ~/usr/python/
is for programs installed with
.Xr pip 1 ;
.Pa ~/usr/go/
is for programs installed with
.Xr go 1 ;
etc.
Each subdirectory contains the directories
.Pa bin/ ,
.Pa src/ ,
.Pa man/ ,
and
.Pa etc/
(for binaries, source, manual, and other files).
For example,
.Pa ~/usr/go/bin/lf
is the binary for lf installed by
.Xr go 1 ;
.Pa ~/usr/local/man/man1/xmenu.1
is the manual for
.Xr xmenu 1 installed manually; etc.
.It Pa ~/var/
Directory for files managed automatically by applications.
For example,
.Pa ~/var/trash/
contains trashed files managed by
.Xr trash 1 ;
.Pa ~/var/mail/
contains mail managed by
.Xr mutt 1
and
.Xr mbsync 1 ;
.Pa ~/var/history/
contains command history from interpreters like
.Xr ksh 1
and others;
.Pa ~/var/cache
contains cached files generated by several programs.
.El
.Sh SEE ALSO
.Xr hier 7
.Sh TODO
TODO
